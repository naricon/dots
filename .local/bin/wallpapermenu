#!/usr/bin/env bash

# slightly scuffed wallpaper picker menu for use with pywal - uses nsxiv if installed, otherwise uses dmenu

FOLDER=~/media/pape/ # wallpaper folder
SCRIPT=refresh # script to run after wal for refreshing programs, etc.


menu () {

CHOICE=$(nsxiv -g 800x600+560+240 -otbr $FOLDER/*)

case $CHOICE in
		*.*)
            pkill gifw
            wal -n -i "$CHOICE" -o $SCRIPT --cols16
            
            sleep 0.5

            if [[ "$CHOICE" == *.gif ]]; then
                STYLE=$(echo -e "stretch\ncenter\ntile" | dmenu -c -l 3 -p "GIF Style:")
                [[ -n "$STYLE" ]] && gifw "$CHOICE" "$STYLE" &
            else
                STYLE=$(echo -e "scaled\ncentered\ntiled\nzoomed\nzoomed fill" | dmenu -c -l 5 -p "Image Style:")
                case "$STYLE" in
                    scaled) nitrogen --set-scaled "$CHOICE" ;;
                    centered) nitrogen --set-centered "$CHOICE" ;;
                    tiled) nitrogen --set-tiled "$CHOICE" ;;
                    zoomed) nitrogen --set-zoom "$CHOICE" ;;
                    zoomed\ fill) nitrogen --set-zoom-fill "$CHOICE" ;;
                    *) nitrogen --set-auto "$CHOICE" ;;
                esac
            fi
            ;;
		*) exit 0 ;;
esac
}

# If given arguments:
# First argument will be used by pywal as wallpaper/dir path
# Second will be used as theme (use wal --theme to view built-in themes)

case "$#" in
		0) menu ;;
		1) wal -i "$1" -o $SCRIPT ;;
		2) wal -i "$1" --theme $2 -o $SCRIPT ;;
		*) exit 0 ;;
esac
